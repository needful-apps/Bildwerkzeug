<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImageTool - Image Editor</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1 data-i18n="appTitle">üñºÔ∏è ImageTool</h1>
                    <p data-i18n="appSubtitle">Edit images via Drag & Drop</p>
                </div>
                <nav class="header-nav">
                    <div class="lang-switcher">
                        <button class="lang-btn" data-lang="en" onclick="setLanguage('en')">EN</button>
                        <button class="lang-btn" data-lang="de" onclick="setLanguage('de')">DE</button>
                    </div>
                    {% if config.LOGIN_REQUIRED %}
                    <span class="user-info">üë§ {{ current_user.username }}</span>
                    {% if current_user.is_admin %}
                    <a href="{{ url_for('admin_panel') }}" class="nav-link" data-i18n="admin">‚öôÔ∏è Admin</a>
                    {% endif %}
                    <a href="{{ url_for('logout') }}" class="nav-link" data-i18n="logout">üö™ Logout</a>
                    {% endif %}
                </nav>
            </div>
        </header>

        <main>
            <!-- Welcome Screen - Auswahl bei vorhandenen Bildern -->
            <div id="welcomeScreen" class="welcome-screen hidden">
                <div class="welcome-container">
                    <!-- Neue Bilder bearbeiten -->
                    <div class="welcome-option" onclick="startNewSession()">
                        <div class="welcome-option-content">
                            <span class="welcome-icon">üìÅ</span>
                            <h3 data-i18n="newImagesTitle">Edit new images</h3>
                            <p data-i18n="newImagesDesc">Start fresh with new images</p>
                        </div>
                    </div>
                    
                    <!-- Vorhandene Bilder weiterbearbeiten -->
                    <div class="welcome-option welcome-option-existing" onclick="continueSession()">
                        <div class="welcome-option-content">
                            <span class="welcome-icon">üîÑ</span>
                            <h3 data-i18n="continueImagesTitle">Continue editing</h3>
                            <p data-i18n="continueImagesDesc">Resume with your saved images</p>
                        </div>
                        <div id="savedImagesPreview" class="saved-images-preview"></div>
                    </div>
                </div>
            </div>
            
            <!-- Drop Zone -->
            <div id="dropzone" class="dropzone">
                <div class="dropzone-content">
                    <span class="dropzone-icon">üìÅ</span>
                    <p data-i18n="dropzoneText">Drag images here or click to select</p>
                    <p class="dropzone-hint" data-i18n="dropzoneHint">Multiple images possible</p>
                    <input type="file" id="fileInput" accept="image/*" multiple hidden>
                </div>
            </div>

            <!-- Bildvorschau und Bearbeitung -->
            <div id="editor" class="editor hidden">
                <div class="editor-layout">
                    <!-- Seitenleiste mit Werkzeugen -->
                    <aside class="sidebar">
                        <h2 data-i18n="tools">Tools</h2>
                        
                        <!-- Gr√∂√üe √§ndern -->
                        <div class="tool-section">
                            <h3 data-i18n="resize">üìê Resize</h3>
                            
                            <!-- Resize Tabs -->
                            <div class="resize-tabs">
                                <button class="resize-tab active" onclick="switchResizeTab('pixel')" data-i18n="pixel">Pixel</button>
                                <button class="resize-tab" onclick="switchResizeTab('percent')" data-i18n="percent">Percent</button>
                                <button class="resize-tab" onclick="switchResizeTab('maxsize')" data-i18n="maxMB">Max MB</button>
                            </div>
                            
                            <!-- Pixel Tab -->
                            <div id="resizePixel" class="resize-content active">
                                <div class="input-group">
                                    <label data-i18n="widthPx">Width (px):</label>
                                    <input type="number" id="resizeWidth" min="1" max="10000">
                                </div>
                                <div class="input-group">
                                    <label data-i18n="heightPx">Height (px):</label>
                                    <input type="number" id="resizeHeight" min="1" max="10000">
                                </div>
                                <div class="input-group checkbox">
                                    <input type="checkbox" id="keepAspect" checked>
                                    <label for="keepAspect" data-i18n="keepAspectRatio">Keep aspect ratio</label>
                                </div>
                                <div class="button-row">
                                    <button onclick="resize()" class="btn" data-i18n="apply">Apply</button>
                                    <button onclick="batchResize()" class="btn btn-batch" data-i18n-title="applyAll">üîÑ All</button>
                                </div>
                            </div>
                            
                            <!-- Prozent Tab -->
                            <div id="resizePercent" class="resize-content">
                                <div class="input-group">
                                    <label data-i18n="scaling">Scaling:</label>
                                    <input type="range" id="scalePercent" min="1" max="200" value="100">
                                    <span id="scalePercentValue">100</span>%
                                </div>
                                <div class="scale-presets">
                                    <button onclick="setScalePercent(25)" class="btn btn-small">25%</button>
                                    <button onclick="setScalePercent(50)" class="btn btn-small">50%</button>
                                    <button onclick="setScalePercent(75)" class="btn btn-small">75%</button>
                                    <button onclick="setScalePercent(150)" class="btn btn-small">150%</button>
                                </div>
                                <div class="button-row">
                                    <button onclick="resizeByPercent()" class="btn" data-i18n="scale">Scale</button>
                                    <button onclick="batchResizeByPercent()" class="btn btn-batch" data-i18n-title="applyAll">üîÑ All</button>
                                </div>
                            </div>
                            
                            <!-- Max MB Tab -->
                            <div id="resizeMaxSize" class="resize-content">
                                <div class="input-group">
                                    <label data-i18n="maxFileSize">Maximum file size (MB):</label>
                                    <input type="number" id="maxFileSizeMB" min="0.1" max="50" step="0.1" value="1">
                                </div>
                                <div class="input-group">
                                    <label data-i18n="format">Format:</label>
                                    <select id="maxSizeFormat">
                                        <option value="jpeg" data-i18n="jpegSmallest">JPEG (smallest)</option>
                                        <option value="webp" data-i18n="webpGood">WebP (good compression)</option>
                                        <option value="png" data-i18n="pngLossless">PNG (lossless)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label data-i18n="quality">Quality:</label>
                                    <input type="range" id="maxSizeQuality" min="10" max="95" value="85">
                                    <span id="maxSizeQualityValue">85</span>
                                </div>
                                <div class="button-row">
                                    <button onclick="resizeToMaxSize()" class="btn" data-i18n="compress">Compress</button>
                                    <button onclick="batchResizeToMaxSize()" class="btn btn-batch" data-i18n-title="applyAll">üîÑ All</button>
                                </div>
                                <p class="info-text" id="currentSizeInfo"></p>
                            </div>
                        </div>

                        <!-- Drehen & Spiegeln -->
                        <div class="tool-section">
                            <h3 data-i18n="rotateFlip">üîÑ Rotate & Flip</h3>
                            <div class="button-group">
                                <button onclick="rotate(90)" class="btn btn-small">‚Üª 90¬∞</button>
                                <button onclick="rotate(-90)" class="btn btn-small">‚Ü∫ -90¬∞</button>
                                <button onclick="rotate(180)" class="btn btn-small">180¬∞</button>
                            </div>
                            <div class="button-group">
                                <button onclick="flip('horizontal')" class="btn btn-small" data-i18n="horizontal">‚Üî Horizontal</button>
                                <button onclick="flip('vertical')" class="btn btn-small" data-i18n="vertical">‚Üï Vertical</button>
                            </div>
                            <div class="batch-section">
                                <span class="batch-label" data-i18n="allImages">All images:</span>
                                <div class="button-group">
                                    <button onclick="batchRotate(90)" class="btn btn-small btn-batch">‚Üª 90¬∞</button>
                                    <button onclick="batchRotate(-90)" class="btn btn-small btn-batch">‚Ü∫ -90¬∞</button>
                                    <button onclick="batchFlip('horizontal')" class="btn btn-small btn-batch">‚Üî</button>
                                    <button onclick="batchFlip('vertical')" class="btn btn-small btn-batch">‚Üï</button>
                                </div>
                            </div>
                        </div>

                        <!-- Filter -->
                        <div class="tool-section">
                            <h3 data-i18n="filters">üé® Filters</h3>
                            <div class="button-row">
                                <button onclick="applyFilter('grayscale')" class="btn" data-i18n="grayscale">Grayscale</button>
                                <button onclick="batchApplyFilter('grayscale')" class="btn btn-batch" data-i18n-title="applyAll">üîÑ</button>
                            </div>
                            
                            <div class="input-group">
                                <label data-i18n="blur">Blur:</label>
                                <input type="range" id="blurRadius" min="0" max="20" value="2" step="0.5">
                                <span id="blurValue">2</span>
                            </div>
                            <div class="button-row">
                                <button onclick="blur()" class="btn" data-i18n="blurBtn">Blur</button>
                                <button onclick="batchBlur()" class="btn btn-batch" data-i18n-title="applyAll">üîÑ</button>
                            </div>
                            
                            <div class="input-group">
                                <label data-i18n="sharpness">Sharpness:</label>
                                <input type="range" id="sharpenFactor" min="0" max="5" value="2" step="0.1">
                                <span id="sharpenValue">2</span>
                            </div>
                            <div class="button-row">
                                <button onclick="sharpen()" class="btn" data-i18n="sharpen">Sharpen</button>
                                <button onclick="batchSharpen()" class="btn btn-batch" data-i18n-title="applyAll">üîÑ</button>
                            </div>
                        </div>

                        <!-- Anpassungen -->
                        <div class="tool-section">
                            <h3 data-i18n="adjustments">‚ö° Adjustments</h3>
                            
                            <div class="input-group">
                                <label data-i18n="brightness">Brightness:</label>
                                <input type="range" id="brightness" min="0" max="2" value="1" step="0.1">
                                <span id="brightnessValue">1.0</span>
                            </div>
                            <div class="button-row">
                                <button onclick="adjustBrightness()" class="btn" data-i18n="apply">Apply</button>
                                <button onclick="batchAdjustBrightness()" class="btn btn-batch" data-i18n-title="applyAll">üîÑ</button>
                            </div>
                            
                            <div class="input-group">
                                <label data-i18n="contrast">Contrast:</label>
                                <input type="range" id="contrast" min="0" max="3" value="1" step="0.1">
                                <span id="contrastValue">1.0</span>
                            </div>
                            <div class="button-row">
                                <button onclick="adjustContrast()" class="btn" data-i18n="apply">Apply</button>
                                <button onclick="batchAdjustContrast()" class="btn btn-batch" data-i18n-title="applyAll">üîÑ</button>
                            </div>
                            
                            <div class="input-group">
                                <label data-i18n="saturation">Saturation:</label>
                                <input type="range" id="saturation" min="0" max="3" value="1" step="0.1">
                                <span id="saturationValue">1.0</span>
                            </div>
                            <div class="button-row">
                                <button onclick="adjustSaturation()" class="btn" data-i18n="apply">Apply</button>
                                <button onclick="batchAdjustSaturation()" class="btn btn-batch" data-i18n-title="applyAll">üîÑ</button>
                            </div>
                        </div>

                        <!-- Zuschneiden -->
                        <div class="tool-section">
                            <h3 data-i18n="crop">‚úÇÔ∏è Crop</h3>
                            <div class="input-row">
                                <div class="input-group">
                                    <label data-i18n="left">Left:</label>
                                    <input type="number" id="cropLeft" min="0" value="0">
                                </div>
                                <div class="input-group">
                                    <label data-i18n="top">Top:</label>
                                    <input type="number" id="cropTop" min="0" value="0">
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label data-i18n="right">Right:</label>
                                    <input type="number" id="cropRight" min="0">
                                </div>
                                <div class="input-group">
                                    <label data-i18n="bottom">Bottom:</label>
                                    <input type="number" id="cropBottom" min="0">
                                </div>
                            </div>
                            <button onclick="crop()" class="btn" data-i18n="cropBtn">Crop</button>
                        </div>

                        <!-- Aktionen -->
                        <div class="tool-section actions">
                            <h3 data-i18n="actions">üíæ Actions</h3>
                            <button onclick="resetImage()" class="btn btn-secondary" data-i18n="reset">‚Ü© Reset</button>
                            <button onclick="newImage()" class="btn btn-secondary" data-i18n="newImage">üìÅ New Image</button>
                            
                            <div class="input-group">
                                <label data-i18n="format">Format:</label>
                                <select id="downloadFormat">
                                    <option value="png">PNG</option>
                                    <option value="jpeg">JPEG</option>
                                    <option value="webp">WebP</option>
                                </select>
                            </div>
                            <div class="input-group" id="qualityGroup">
                                <label data-i18n="quality">Quality:</label>
                                <input type="range" id="downloadQuality" min="1" max="100" value="95">
                                <span id="qualityValue">95</span>
                            </div>
                            <button onclick="downloadImage()" class="btn btn-primary" data-i18n="download">‚¨á Download</button>
                            <button onclick="downloadAllImages()" class="btn btn-primary btn-zip" data-i18n="downloadAllZip">üì¶ All as ZIP</button>
                        </div>
                    </aside>

                    <!-- Bildvorschau -->
                    <div class="preview-area">
                        <div class="image-info" id="imageInfo">
                            <span id="imageName">-</span>
                            <span id="imageDimensions">-</span>
                        </div>
                        <div class="image-container">
                            <img id="previewImage" src="" alt="Vorschau">
                        </div>
                        
                        <!-- Bildergalerie -->
                        <div class="gallery-section">
                            <div class="gallery-header">
                                <h3 data-i18n="uploadedImages">üñºÔ∏è Uploaded Images</h3>
                                <button onclick="addMoreImages()" class="btn btn-small btn-add" data-i18n="addMore">‚ûï Add more</button>
                                <input type="file" id="addFileInput" accept="image/*" multiple hidden>
                            </div>
                            <div id="gallery" class="gallery"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Loading Overlay -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p data-i18n="processing">Processing...</p>
        </div>

        <!-- Fehler-Toast -->
        <div id="toast" class="toast hidden"></div>
    </div>

    <script src="{{ url_for('static', filename='translations.js') }}"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
